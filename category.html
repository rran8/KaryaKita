<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KaryaKita - Kategori</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-50">

  <!-- Navbar -->
  <nav class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16 items-center">
        <!-- Logo -->
        <div class="flex items-center gap-2">
          <div class="w-8 h-8 bg-indigo-700 text-white flex items-center justify-center rounded-full font-bold">K</div>
          <span id="KaryaKita" class="font-semibold text-lg text-gray-900">KaryaKita</span>
        </div>

        <!-- Nav Links -->
        <div class="flex space-x-6 text-sm text-gray-600">
          <a href="index.html" class="hover:text-black">Galeri</a>
          <a href="#" class="hover:text-black">Tentang</a>
          <a href="#" class="hover:text-black">Kontak</a>
        </div>

        <!-- Right Section -->
        <div class="flex items-center space-x-4 relative">
          <!-- Notification Icon -->
          <button id="notifBtn" class="relative focus:outline-none">
            <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" stroke-width="2"
              viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M15 17h5l-1.405-1.405C18.79 14.79 18 13.42 18 12V9a6 6 0 10-12 0v3c0 1.42-.79 2.79-1.595 3.595L3 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
            </svg>
            <span class="absolute top-0 right-0 w-2 h-2 bg-red-600 rounded-full"></span>
          </button>

          <!-- Dropdown Notifikasi -->
          <div id="notifBox" class="hidden absolute top-10 right-12 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-10">
            <div class="p-4 text-sm text-gray-700">
              <p class="font-medium mb-2">Notifikasi</p>
              <ul class="space-y-2">
                <li class="hover:bg-gray-100 p-2 rounded">üé® Karya baru ditambahkan</li>
                <li class="hover:bg-gray-100 p-2 rounded">üë§ Seniman baru bergabung</li>
                <li class="hover:bg-gray-100 p-2 rounded">üí¨ Komentar baru pada karya kamu</li>
              </ul>
            </div>
          </div>

          <!-- User Avatar -->
          <div class="w-8 h-8 bg-indigo-200 text-indigo-800 flex items-center justify-center rounded-full font-medium" id="user-avatar">S</div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Gallery Section -->
  <div class="max-w-7xl mx-auto px-6 py-10">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold text-gray-800" id="category-title">Kategori Karya: [Nama Kategori]</h1>

      <!-- Upload Button (murid only) -->
      <button id="uploadBtn" class="hidden bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 text-sm font-medium">
        <a href="upload.html">‚¨ÜÔ∏è Unggah Karya</a>
      </button>
    </div>

    <!-- Tabs for Categories -->
    <div class="flex space-x-6 border-b mb-8 text-gray-600 text-sm font-medium" id="category-tabs">
      <a href="index.html" class="hover:text-indigo-500 pb-2">Semua Karya</a>
      <!-- Categories will be dynamically loaded here -->
    </div>

    <!-- Artwork Cards Container -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6" id="artwork-grid">
      <!-- Artworks for the specific category will be loaded here dynamically -->
      <p class="text-center text-gray-500 col-span-full">Memuat karya...</p>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-10">
     <div class="max-w-7xl mx-auto px-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-10">
    
    <!-- Logo dan Deskripsi -->
    <div>
      <div class="flex items-center gap-2 mb-2">
        <div class="bg-white text-black rounded w-6 h-6 flex items-center justify-center font-bold text-sm">K</div>
        <span class="font-bold text-lg">KaryaKita</span>
      </div>
      <p class="text-sm text-gray-400">Platform Galeri Karya Siswa</p>
    </div>

    <!-- Navigasi -->
    <div>
      <h3 class="text-sm font-semibold mb-3">NAVIGASI</h3>
      <ul class="space-y-2 text-sm text-gray-400">
        <li><a href="index.html" class="hover:text-white">Beranda</a></li>
        <li><a href="#" class="hover:text-white">Galeri</a></li>
        <li><a href="#" class="hover:text-white">Tentang</a></li>
      </ul>
    </div>

    <!-- Kategori -->
    <div id="footer-categories">
      <h3 class="text-sm font-semibold mb-3">KATEGORI</h3>
      <ul class="space-y-2 text-sm text-gray-400">
        <!-- Categories will be dynamically loaded here -->
      </ul>
    </div>

    <!-- Kontak -->
    <div>
      <h3 class="text-sm font-semibold mb-3">KONTAK</h3>
      <ul class="space-y-2 text-sm text-gray-400">
        <li class="flex items-center gap-2">
          <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" stroke-width="1.5"
               viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25H4.5a2.25 2.25 0 01-2.25-2.25V6.75M21.75 6.75L12 13.5 2.25 6.75" />
          </svg>
          <span>info@karyakita.com</span>
        </li>
        <li class="flex items-center gap-2">
          <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" stroke-width="1.5"
               viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M2.25 6.75v10.5A2.25 2.25 0 004.5 19.5h15a2.25 2.25 0 002.25-2.25V6.75M4.5 4.5h15A2.25 2.25 0 0121.75 6.75v10.5A2.25 2.25 0 0119.5 19.5h-15A2.25 2.25 0 012.25 17.25V6.75A2.25 2.25 0 014.5 4.5z" />
          </svg>
          <span>+62 123 4567 890</span>
        </li>
      </ul>
    </div>
  </div>

  <!-- Copyright -->
  <div class="mt-10 border-t border-gray-800 pt-4 text-center text-xs text-gray-500">
    ¬© 2023 KaryaKita. All rights reserved.
  </div>
</footer>

  <!-- Scripts -->
  <script>
    // Simulate user role for upload button visibility
    const userRole = "student"; // Ganti ke "admin" atau "guest" untuk menguji peran yang berbeda

    // Upload Button visibility based on role
    if (userRole === "student" || userRole === "admin") {
      document.getElementById("uploadBtn").classList.remove("hidden");
    }

    // Notification toggle
    const notifBtn = document.getElementById("notifBtn");
    const notifBox = document.getElementById("notifBox");

    notifBtn.addEventListener("click", () => {
      notifBox.classList.toggle("hidden");
    });

    // Close notification dropdown when clicking outside
    document.addEventListener("click", function (e) {
      if (!notifBtn.contains(e.target) && !notifBox.contains(e.target)) {
        notifBox.classList.add("hidden");
      }
    });

    // Fungsi untuk memuat kategori ke tab dan footer
    async function loadCategories() {
        const categoryTabsContainer = document.getElementById('category-tabs');
        const footerCategoriesContainer = document.querySelector('#footer-categories ul');

        try {
            const response = await fetch('api/get_categories.php');
            const data = await response.json();

            if (data.success) {
                const categories = data.categories;
                // Bersihkan kategori dummy yang ada jika ada
                while (categoryTabsContainer.children.length > 1) { // Pertahankan link "Semua Karya"
                    categoryTabsContainer.removeChild(categoryTabsContainer.lastChild);
                }
                footerCategoriesContainer.innerHTML = '';

                categories.forEach(cat => {
                    // Tambahkan ke tab kategori
                    const tabLink = document.createElement('a');
                    tabLink.href = `category.html?slug=${cat.slug}`;
                    tabLink.className = 'hover:text-indigo-500';
                    tabLink.setAttribute('data-category', cat.slug);
                    tabLink.innerText = cat.name;
                    categoryTabsContainer.appendChild(tabLink);

                    // Tambahkan ke kategori footer
                    const footerLi = document.createElement('li');
                    const footerLink = document.createElement('a');
                    footerLink.href = `category.html?slug=${cat.slug}`;
                    footerLink.className = 'hover:text-white';
                    footerLink.innerText = cat.name;
                    footerLi.appendChild(footerLink);
                    footerCategoriesContainer.appendChild(footerLi);
                });
            } else {
                console.error("Gagal memuat kategori:", data.message);
            }
        } catch (error) {
            console.error("Error fetching categories:", error);
        }
    }

    // Fungsi untuk mendapatkan nama kategori dari slug
    async function getCategoryName(slug) {
        try {
            const response = await fetch('api/get_categories.php');
            const data = await response.json();
            if (data.success) {
                const category = data.categories.find(cat => cat.slug === slug);
                return category ? category.name : "Kategori Tidak Dikenal";
            }
        } catch (error) {
            console.error("Error fetching category name:", error);
        }
        return "Kategori Tidak Dikenal";
    }

    // Fungsi untuk menyorot tab kategori yang aktif
    function highlightActiveCategoryTab(activeSlug) {
        const categoryTabs = document.querySelectorAll('#category-tabs a');
        categoryTabs.forEach(tab => {
            tab.classList.remove('text-indigo-600', 'border-b-2', 'border-indigo-600');
            if (tab.getAttribute('data-category') === activeSlug) {
                tab.classList.add('text-indigo-600', 'border-b-2', 'border-indigo-600');
            }
        });
        // Penanganan khusus untuk tab "Semua Karya" di index.html
        if (!activeSlug && window.location.pathname.includes('index.html')) {
             document.querySelector('#category-tabs a[href="index.html"]').classList.add('text-indigo-600', 'border-b-2', 'border-indigo-600');
        }
    }

    // Fungsi untuk mengambil karya seni dari PHP backend berdasarkan kategori
    async function fetchArtworks(containerId, categorySlug = null) {
        const container = document.getElementById(containerId);
        container.innerHTML = '<p class="text-center text-gray-500 col-span-full">Memuat karya...</p>';

        let url = 'api/get_artworks.php';
        if (categorySlug) {
            url += `?category_slug=${categorySlug}`;
        }

        try {
            const response = await fetch(url);
            const data = await response.json();

            container.innerHTML = ''; // Hapus pesan loading

            if (data.success && data.artworks.length > 0) {
                data.artworks.forEach(work => {
                    const artworkCard = `
                        <div class="bg-white rounded-lg shadow p-4">
                            <img src="${work.media_url || 'https://placehold.co/300x200/cccccc/000000?text=No+Image'}" alt="${work.title}" class="w-full h-48 object-cover rounded" onerror="this.onerror=null;this.src='https://placehold.co/300x200/cccccc/000000?text=No+Image';" />
                            <h3 class="mt-4 font-semibold text-lg text-gray-800">${work.title}</h3>
                            <p class="text-sm text-gray-500">oleh ${work.student_name}</p>
                            <a href="detail.html?id=${work.id}" class="mt-2 text-indigo-600 text-sm font-medium block">Lihat detail ‚Üí</a>
                        </div>
                    `;
                    container.innerHTML += artworkCard;
                });
            } else {
                container.innerHTML = `<p class="text-center text-gray-500 col-span-full">Tidak ada karya ditemukan di kategori ini.</p>`;
            }
        } catch (error) {
            console.error("Error fetching artworks:", error);
            container.innerHTML = `<p class="text-center text-red-500 col-span-full">Gagal memuat karya: ${error.message}</p>`;
        }
    }

    // Dapatkan slug kategori dari URL
    const urlParams = new URLSearchParams(window.location.search);
    const currentCategorySlug = urlParams.get('slug');

    // Muat konten saat DOM selesai dimuat
    document.addEventListener('DOMContentLoaded', async () => {
        await loadCategories(); // Muat kategori ke navbar tab dan footer
        
        // Atur judul kategori
        if (currentCategorySlug) {
            const categoryName = await getCategoryName(currentCategorySlug);
            document.getElementById('category-title').innerText = `Galeri Karya: ${categoryName}`;
        } else {
            document.getElementById('category-title').innerText = `Galeri Karya`;
        }

        fetchArtworks('artwork-grid', currentCategorySlug); // Muat karya untuk kategori saat ini
        highlightActiveCategoryTab(currentCategorySlug); // Sorot tab kategori yang aktif
    });
  </script>
</body>
</html>
